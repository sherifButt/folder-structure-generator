

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Super docs helpers/createStructure.js</title>
  
    <link rel="icon" type="image/svg+xml" href="images/favicon.svg">
    <link rel="shortcut icon" type="" href="./favicon.png"/>
    <link rel="icon" type="" href="./favicon.png"/>
  
  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css2?family=Muli&family=Libre+Barcode+39+Text&family=Anton&family=Fira+Mono&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
   <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/swagger-ui/4.18.3/swagger-ui.css" />
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="styles/style.css">
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  
</head>



<body class="layout small-header">
    <script src="scripts/img-alt-caption.js"></script>
    <script src="scripts/jsdoc-mermaid.js"></script>
    
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
             
                <a class="image" href="index.html">
                    <img src="images/logo.png" alt="logo">
                </a>
            
             
                <a href="index.html">
                    <h1 class="navbar-item">Super Docs</h1>
                </a>
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                    <a
                        href="changelog.html"
                        class="link"
                    >
                      LOG
                    </a>
                
                
                    <a
                        href="swagger.html"
                        class="link"
                    >
                       API
                    </a>
                
                
                <div class="dropdown is-hoverable is-right">
                    <a class="dropdown-trigger link">
                        Tutorials
                        <i class="fas fa-chevron-down fa-xs"></i>
                    </a>
                    <div class="dropdown-menu">
                        <div class="dropdown-content">
                        
                            <a class="dropdown-item" href="tutorial-my-awesome-tutorial.html">
                                my-awesome-tutorial
                            </a>
                        
                        </div>
                    </div>
                </div>
                
                 
                    
                        <a
                            class="link user-link "
                            href="https://app.gaia-lens.com/login"
                        >
                            ðŸš€ webapp
                        </a>
                    
                        <a
                            class="link user-link "
                            href="https://www.gaia-lens.com"
                        >
                            website
                        </a>
                    
                        <a
                            class="link user-link "
                            href="https://github.com/GaiaLens/web-app-react"
                        >
                            <svg xmlns='http://www.w3.org/2000/svg' width='24' marginTop='10' height='24' viewBox='0 0 24 24'><path d='M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z'/></svg>
                        </a>
                    
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
                <div class="search-wrapper">
                    <input id="search" type="text" placeholder="Search docs..." class="input">
                </div>
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2> <h2><a href="changelog.html">LOG</a></h2>  <h2><a href="swagger.html">API</a></h2> <div class="category"><h3>Modules</h3><ul><li><a href="module-cooldown.html">cooldown</a></li><li><a href="module-isResponseComplete%2520-%2520See%2520%257B@tutorial%2520howtouse%257D.html">isResponseComplete - See {@tutorial howtouse}</a></li><li><a href="module-validators.html">validators</a></li></ul><h3>Global</h3><ul><li><a href="global.html#cleanCode">cleanCode</a></li><li><a href="global.html#corsOptions">corsOptions</a></li><li><a href="global.html#createOutputDir">createOutputDir</a></li><li><a href="global.html#createStructure">createStructure</a></li><li><a href="global.html#getGpt">getGpt</a></li><li><a href="global.html#getPayloadFromFile">getPayloadFromFile</a></li><li><a href="global.html#parsePayload">parsePayload</a></li><li><a href="global.html#swaggerDefinition">swaggerDefinition</a></li><li><a href="global.html#zipFolder">zipFolder</a></li></ul></div><div class="category"><h2>Helpers</h2><h3>Global</h3><ul><li><a href="global.html#getGeneratedCode">getGeneratedCode</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>helpers/createStructure.js</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const fs = require('fs');
const path = require('path');
const yaml = require('js-yaml');
const generateCode = require('./generateCode');


/**
 * Main function that creates the directory structure based on the JSON or YAML file provided.
 *
 * @param {string} basePath - The path to the folder where the directory structure will be created.
 * @param {Object} structure - The directory structure to be created.
 * @throws {Error} - Throws an error if there is an issue while creating the structure.
 * @returns {Promise} - Returns a promise that resolves when the structure is created. 
 */
async function createStructure(basePath, structure, messages) {

    // check if messages is array of strings and convert it to array of objects
    if (typeof messages[0] === 'string') messages = messages.map(message => ({ role: 'system', content: message }))

    // create context by new pormpts to message object
    let _messages = [
        {
            role: "system",
            // content: `You are a experianced nodejs developer with 10 years of coding experiance, Return only the JavaScript, html, css code only retrun markdown if instructed to do so. if you will provide any description or any other text exept code please start it with "//" to comment it in code. if you will confirm saying "// Sure, here's an"... etc start it with "//" `
            content: `You are a experianced nodejs developer with 10 years of coding experiance, Return only the JavaScript, html, css code only retrun markdown if instructed to do so. provide jsDocs and swagger for routes.\n Note: don't provide svg tags only add comments {/**svg name /}, don't provide any description or any other text exept code. only provide markdow if you will inmplment ".md" file. if you will confirm saying "Sure, here's an" or comment saying "To", "Here is" ... etc start it with "//" to comment it out in code.`
        },
        ...messages
    ];

    // remove douplicate messages from _messages array
    _messages = _messages.filter((message, index, self) =>
        index === self.findIndex((t) => (
            t.role === message.role &amp;&amp; t.content === message.content
        ))
    )

    let _structure = { ...structure };

    // Iterate over the structure object
    for (const key in structure) {
        const item = structure[key];
        const itemPath = path.join(basePath, key);


        try {
            // If the item is an object and has instructions and implemented properties, it is a prompt.
            if (item &amp;&amp; typeof item === 'object' &amp;&amp; 'instructions' in item &amp;&amp; 'implemented' in item) {

                // If the item is a file, create the file with the content generated by ChatGPT.
                let userContent = `Implement ${key} by providing full code to the following instructions: `;
                userContent += item.instructions

                // add file name to user content 
                userContent += `\nFile name: ${key}`

                // add dependencies to user content 
                for (const [key, value] of Object.entries(item)) {
                    if (Array.isArray(value) &amp;&amp; value.length > 0) {
                        userContent += `\n${key.charAt(0).toUpperCase() + key.slice(1)}: ${value.join(', ')}`
                    }
                }
                const gptMessages = [..._messages, { role: "user", content: userContent }]
                let code, usage;

                // console.log('process.env.USE_CODE_GENERATOR: ', process.env.USE_CODE_GENERATOR)
                if (process.env.USE_CODE_GENERATOR === 'true') {
                    const { cleanCode, usage: _usage, code: _code } = await generateCode(gptMessages)

                    // clena code is cleand form markdown and comments .. etc
                    code = (process.env.IS_CLEAN_CODE === 'true' &amp;&amp; !userContent.toLowerCase().split(' ').includes('markdown')) ? cleanCode : _code;
                    usage = _usage
                }
                else {
                    code = userContent;
                }
                try { fs.writeFileSync(itemPath, code); }
                catch (err) { console.error('err while saving file: ', itemPath, err.message) }

                // console.log('\x1b[32m%s\x1b[0m', 'messages:', gptMessages)
                // update structure 
                _structure[key].implemented = true;
                _structure[key].code = code;
                _structure[key].usage = usage;

                // console.log('_structure: ', _structure)

                //TODO: update websocket with new structure and messages and send to client
                // console.log('----------->',one&amp;&amp;one)

                // update messages if gpt-4 or usage.prompt_tokens &lt; 2800  to include user 
                // content as system message as token size can handel bigger messages
                if (process.env.GPT_MODEL_ID === 'gpt-4' || usage.prompt_tokens &lt; 2800) {
                    _messages = [..._messages, { role: "system", content: userContent }]
                }


            } else if (typeof item === 'object' &amp;&amp; item !== null) {

                // If the item is an object (i.e., a folder), create the folder and call the function recursively.
                if (!fs.existsSync(itemPath)) {
                    try { fs.mkdirSync(itemPath, { recursive: true }); }
                    catch (err) { console.error('err while saving folder: ', err.message) }
                }

                await createStructure(itemPath, item, [..._messages]);
            } else {

                // If the item is not an object, it might be an empty file or folder.
                if (key.startsWith('.')) {

                    // If the file name starts with a dot, create an empty file.
                    try {
                        fs.writeFileSync(itemPath, '');
                        await createStructure(itemPath, item, [..._messages]);
                    }
                    catch (err) { console.error('err while saving an empty file: ', err.message) }
                } else {

                    const extensionPattern = /\.[0-9a-z]+$/i;
                    if (extensionPattern.test(key)) {

                        // If the file has a valid extension, create an empty file.
                        try {
                            fs.writeFileSync(itemPath, '');
                            await createStructure(itemPath, item, [..._messages]);
                        }
                        catch (err) { console.error('err while saving an empty file: ', err.message) }
                    } else {

                        // If the file name does not have a valid extension, create a folder.
                        if (!fs.existsSync(itemPath)) {
                            try {
                                fs.mkdirSync(itemPath, { recursive: true });
                                await createStructure(itemPath, item, [..._messages]);
                            }
                            catch (err) { console.error('err while saving a folder: ', err.message) }
                        }
                    }
                }
            }
        } catch (error) {
            console.error(`Error details: Key: ${key}, Item: ${JSON.stringify(item)}, ItemPath: ${itemPath}`);
            throw new Error(`Error while creating ${itemPath}: ${error.message}`);
        }
    }
}

module.exports = createStructure;

// create mermaid sequencflow for createStructure function in markdown
</code></pre>
        </article>
    </section>




            </div>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>
<script src="scripts/copycode.js"></script>

<script src="scripts/search.js"> </script>
<script src="scripts/tapMenueDropDown.js"> </script>



</body>
</html>
